# proj10实训四：同步与互斥

## 背景了解：管道通信

------

[TOC]

### 一、概念积累

#### 1.1 同步

​	不同进程之间的若干程序片断，它们的运行必须严格按照规定的某种先后次序来运行，这种先后次序依赖于要完成的特定的任务。如果用对资源的访问来定义的话，同步是指在互斥的基础上（大多数情况），通过其它机制实现访问者对资源的有序访问。在大多数情况下，同步已经实现了互斥，特别是所有写入资源的情况必定是互斥的。少数情况是指可以允许多个访问者同时访问资源。

#### 1.2 互斥

​	散布在不同进程之间的若干程序片断，当某个进程运行其中一个程序片段时，其它进程就不能运行它们之中的任一程序片段，只能等到该进程运行完这个程序片段后才可以运行。如果用对资源的访问来定义的话，互斥某一资源同时只允许一个访问者对其进行访问，具有唯一性和排它性。但互斥无法限制访问者对资源的访问顺序，即访问是无序的。

#### 1.3 死锁

​	如果一组进程中的每一个进程都在等待仅由该组进程中的其他进程才能引发的事件，那么该组进程就是死锁的。或者在两个或多个并发进程中，如果每个进程持有某种资源而又都等待别的进程释放它或它们现在保持着的资源，在未改变这种状态之前都不能向前推进，称这一组进程产生了死锁。通俗地讲，就是两个或多个进程被无限期地阻塞、相互等待的一种状态。

​	**死锁产生条件：**

1. 互斥条件 (Mutual exclusion)：资源不能被共享，只能由一个进程使用。

2. 请求与保持条件 (Hold and wait)：已经得到资源的进程可以再次申请新的资源。

3. 非抢占条件 (No pre-emption)：已经分配的资源不能从相应的进程中被强制地剥夺。

4. 循环等待条件 (Circular wait)：系统中若干进程组成环路，该环路中每个进程都在等待相邻进程正占用的资源。

#### 1.4 信号量

​	用于进程间传递信号的一个整数。在信号两上只可以进行三种操作，即初始化，递增，递减。这三种操作分别都是原子操作。递减作用于阻塞一个进程，递增作用于解除一个进程的阻塞。信号量也称为计数信号量或一般信号量。

​	信号量是不要求忙等的同步互斥工具。一种信号量表示一种资源。信号量的值表示可用资源的个数。
​	当资源不可用时，进程将阻塞（避免忙等）（加入阻塞队列），直到另一进程释放资源时才被唤醒。

​	信号量 s 只能被下面的两个原语访问：

1. **semWait (s)** 也称作 P (s) 操作，wait (s) —— 本进程请求分配一个资源；

2. **semSignal (s)** 也称作 V (s) 操作，signal (s) —— 本进程释放一个资源；

​	**注意：**

1. semWaits (s)、semSignal (s) 操作必须 成对出现。

2. 用于互斥时，位于同一进程内，临界区前后。

3. 用于同步时，交错出现于两个合作进程内。

4. 多个semWait () 的次数不能颠倒，否则可能导致死锁。用于同步的semWait (s1) 应出现在用于互斥的semWait (s2) 之前。

5. 多个semSignal () 操作的次序可任意。

### 二、管道通信

​	**进程间通信（Interprocess communication 也叫IPC）**：指两个或多个进程之间进行数据交互的过程。进程之间可以通过信息交换的方式通信。根据信息交换的方式不同，可以将进程通信分为：

- 共享存储
- 信息传递
- 管道通信

#### 2.1 管道

​	进程间的通信(IPC)有多种方式，**管道**是其中**最基本的方式**。

1. 管道是**半双工**的，即是**单向**的。
2. 管道是**FIFO**(先进先出)的。
3. 在实际的多进程间通信时，可以理解为有一条管道，而每个进程都有两个可以使用管道的"端口"，**分别负责进行数据的读取与发送**。

#### 2.2 类型

##### 1．有名管道

​	一个可以在文件系统中长期存在的、具有路径名的文件。用系统调用mknod( )建立。它克服无名管道使用上的局限性，可让更多的进程也能利用管道进行通信。因而其它进程可以知道它的存在，并能利用路径名来访问该文件。对有名管道的访问方式与访问其他文件一样，需先用open( )打开。

##### 2．无名管道

​	一个临时文件。利用pipe( )建立起来的无名文件（无路径名）。只用该系统调用所返回的文件描述符来标识该文件，故只有调用pipe( )的进程及其子孙进程才能识别此文件描述符，才能利用该文件（管道）进行通信。当这些进程不再使用此管道时，核心收回其索引结点。二种管道的读写方式是相同的。

##### 3．pipe文件的建立

​	分配磁盘和内存索引结点、为读进程分配文件表项、为写进程分配文件表项、分配用户文件描述符

##### 4．读/写进程互斥

​	内核为地址设置一个读指针和一个写指针，按先进先出顺序读、写。为使读、写进程互斥地访问pipe文件，需使各进程互斥地访问pipe文件索引结点中的直接地址项。因此，每次进程在访问pipe文件前，都需检查该索引文件是否已被上锁。若是，进程便睡眠等待，否则，将其上锁，进行读/写。操作结束后解锁，并唤醒因该索引结点上锁而睡眠的进程。

------

**参考文章：**

[1]【操作系统】进程的通信（1)——管道通信：(https://blog.csdn.net/weixin_73595045/article/details/143089080)

[2]  操作系统实验5-进程通信：（二）管道通信：(https://blog.csdn.net/mrqzgmzlb/article/details/130070772)

[3]  操作系统知识点回顾—互斥和同步：(https://blog.csdn.net/qq_52324490/article/details/111408992)

[4]  操作系统 --- 进程的同步和互斥问题以及进程互斥实现方法（软件、硬件实现）、同步机制遵循的四条准则：(https://blog.csdn.net/m0_48241022/article/details/142315009)
